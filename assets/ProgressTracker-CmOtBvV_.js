import{j as e}from"./ui-vendor-B50KzqUP.js";import{u as s}from"./query-vendor-CSOQ5a_6.js";import{C as t,a,b as r,e as c,s as l}from"./index-pAwTUmbv.js";import{L as o,P as i,b as n}from"./label-Dn_Iw-YU.js";import{B as d}from"./badge-Dz51AyLj.js";import{C as m}from"./circle-check-DKVmP6Q0.js";import{C as x}from"./circle-alert-CS47a3vq.js";import{f,s as u}from"./sv-qPpAa4hK.js";const h=({source:h})=>{const{data:p,isLoading:j}=s({queryKey:["progress",h],queryFn:async()=>{const{data:e,error:s}=await l.from("data_fetch_progress").select("*").eq("source",h).order("last_fetched_at",{ascending:!1});if(s)throw s;return e},refetchInterval:5e3}),{data:g}=s({queryKey:["fetch-control",h],queryFn:async()=>{const{data:e,error:s}=await l.from("data_fetch_control").select("*").eq("source",h);if(s)throw s;return e||[]},refetchInterval:5e3});return j||!p||0===p.length?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"HÃ¤mtningsframsteg"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(s=>{const l=s.total_items?s.items_fetched/s.total_items*100:0,h=(p=s.data_type,null==g?void 0:g.find(e=>e.data_type===p));var p;const j="stopped"===s.status||!0===(null==h?void 0:h.should_stop);"completed"===s.status||s.status;const _="completed"===s.status?"text-success":"failed"===s.status?"text-error":j?"text-warning":"text-info";return e.jsxs(t,{children:[e.jsx(a,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{className:"text-base",children:s.data_type}),e.jsxs("div",{className:"flex items-center gap-2",children:[j&&e.jsx(d,{variant:"outline",className:"text-warning border-warning",children:"STOPPAD"}),"completed"===s.status&&e.jsx(m,{className:`h-4 w-4 ${_}`}),"failed"===s.status&&e.jsx(x,{className:`h-4 w-4 ${_}`}),"in_progress"===s.status&&!j&&e.jsx(o,{className:`h-4 w-4 ${_} animate-spin`})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[s.items_fetched," / ",s.total_items||"?"]}),e.jsxs("span",{children:[Math.round(l),"%"]})]}),e.jsx(i,{value:l}),s.total_pages&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Sida ",s.current_page," / ",s.total_pages]}),s.last_fetched_at&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(n,{className:"h-3 w-3"}),f(new Date(s.last_fetched_at),{addSuffix:!0,locale:u})]}),s.error_message&&e.jsx("p",{className:"text-xs text-error",children:s.error_message})]})})]},s.id)})})]})};export{h as P};
